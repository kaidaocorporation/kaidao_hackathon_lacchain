<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTraceDAO - Agricultural Traceability</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #eff6ff 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-bottom: 4px solid #10b981;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        
        .logo-text h1 {
            font-size: 28px;
            color: #1f2937;
            font-weight: bold;
        }
        
        .logo-text p {
            font-size: 14px;
            color: #6b7280;
        }
        
        .connect-btn {
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .connect-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .connect-btn.connected {
            background: #059669;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 6px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            gap: 4px;
        }
        
        .tab-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: transparent;
            color: #6b7280;
        }
        
        .tab-btn:hover {
            background: #f3f4f6;
        }
        
        .tab-btn.active {
            background: #10b981;
            color: white;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .card-title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 25px;
            text-align: center;
        }
        
        /* Journey Steps */
        .journey-steps {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 40px;
            padding: 20px 0;
        }
        
        .step-item {
            text-align: center;
            position: relative;
        }
        
        .step-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin: 0 auto 10px;
        }
        
        .step-icon.farm { background: #10b981; }
        .step-icon.transport { background: #3b82f6; }
        .step-icon.consumer { background: #f97316; }
        
        .step-line {
            height: 4px;
            background: #d1d5db;
            flex: 1;
            margin: 0 20px;
            border-radius: 2px;
        }
        
        .step-line.active {
            background: #10b981;
        }
        
        .step-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }
        
        .step-subtitle {
            color: #6b7280;
            font-size: 12px;
        }
        
        /* Product Info */
        .product-info {
            background: linear-gradient(135deg, #ecfdf5 0%, #dbeafe 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .info-section h3 {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .info-item i {
            margin-right: 12px;
            width: 20px;
        }
        
        /* Environmental Seals */
        .seals-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .seal-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .seal-card.carbon {
            border-color: #10b981;
        }
        
        .seal-card.deforestation {
            border-color: #3b82f6;
        }
        
        .seal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .seal-header h3 {
            font-size: 16px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .seal-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .seal-icon.carbon { background: #10b981; }
        .seal-icon.deforestation { background: #3b82f6; }
        
        .seal-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .seal-value.carbon { color: #10b981; }
        .seal-value.deforestation { color: #3b82f6; }
        
        .seal-label {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .seal-details {
            color: #9ca3af;
            font-size: 12px;
            margin-bottom: 15px;
        }
        
        .seal-badge {
            display: inline-block;
            background: #ecfdf5;
            color: #065f46;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .seal-badge.deforestation {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .form-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .form-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .form-checkbox input {
            margin-right: 8px;
        }
        
        .form-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .form-btn.primary {
            background: #10b981;
            color: white;
        }
        
        .form-btn.primary:hover {
            background: #059669;
        }
        
        .form-btn.secondary {
            background: #3b82f6;
            color: white;
        }
        
        .form-btn.secondary:hover {
            background: #2563eb;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transform: translateY(100px);
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateY(0);
        }
        
        .toast.success {
            background: #10b981;
        }
        
        .toast.error {
            background: #ef4444;
        }
        
        /* Verification */
        .verify-container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .verify-input {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .verify-result {
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
        }
        
        .verify-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .verify-header i {
            color: #10b981;
            font-size: 20px;
            margin-right: 10px;
        }
        
        .verify-title {
            font-weight: bold;
            color: #065f46;
        }
        
        .verify-details {
            color: #374151;
            font-size: 14px;
        }
        
        .verify-details p {
            margin-bottom: 8px;
        }
        
        .verify-details strong {
            color: #1f2937;
        }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mb-4 { margin-bottom: 16px; }
        .mt-4 { margin-top: 16px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .info-grid,
            .seals-grid,
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .journey-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .step-line {
                display: none;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="logo-text">
                        <h1>EcoTraceDAO</h1>
                        <p>Agricultural Traceability & Environmental Seals</p>
                    </div>
                </div>
                <button id="connectBtn" class="connect-btn">
                    <i class="fas fa-wallet"></i> Connect Wallet
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn active" data-tab="trace">
                <i class="fas fa-route"></i> Product Trace
            </button>
            <button class="tab-btn" data-tab="farmer">
                <i class="fas fa-tractor"></i> Farmer Portal
            </button>
            <button class="tab-btn" data-tab="consumer">
                <i class="fas fa-search"></i> Verify Product
            </button>
        </div>

        <!-- Product Trace Tab -->
        <div id="trace-tab" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-seedling" style="color: #10b981; margin-right: 12px;"></i>
                    Product Journey
                </h2>
                
                <!-- Journey Steps -->
                <div class="journey-steps">
                    <div class="step-item">
                        <div class="step-icon farm">
                            <i class="fas fa-tractor"></i>
                        </div>
                        <div class="step-title">Farm</div>
                        <div class="step-subtitle">Origin</div>
                    </div>
                    <div class="step-line active"></div>
                    <div class="step-item">
                        <div class="step-icon transport">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="step-title">Transport</div>
                        <div class="step-subtitle">Logistics</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item">
                        <div class="step-icon consumer">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="step-title">Consumer</div>
                        <div class="step-subtitle">Purchase</div>
                    </div>
                </div>

                <!-- Product Info Card -->
                <div class="product-info">
                    <div class="info-grid">
                        <div class="info-section">
                            <h3>Product Details</h3>
                            <div class="info-item">
                                <i class="fas fa-coffee" style="color: #92400e;"></i>
                                <span>Café Arábica Premium</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-weight" style="color: #6b7280;"></i>
                                <span>Batch: LOTE001-2025 (1,000 kg)</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar" style="color: #6b7280;"></i>
                                <span>Harvested: March 2025</span>
                            </div>
                        </div>
                        <div class="info-section">
                            <h3>Farm Origin</h3>
                            <div class="info-item">
                                <i class="fas fa-map-marker-alt" style="color: #ef4444;"></i>
                                <span>Finca Café Verde, Bogotá, Colombia</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-user" style="color: #6b7280;"></i>
                                <span>Carlos Mendez (Farmer)</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-shield-alt" style="color: #10b981;"></i>
                                <span style="color: #10b981; font-weight: 600;">Deforestation-Free Certified</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Environmental Seals -->
                <div class="seals-grid">
                    <div class="seal-card carbon">
                        <div class="seal-header">
                            <h3>Carbon Footprint Seal</h3>
                            <div class="seal-icon carbon">
                                <i class="fas fa-leaf"></i>
                            </div>
                        </div>
                        <div class="seal-value carbon">250 kg CO₂</div>
                        <div class="seal-label">per kg of product</div>
                        <div class="seal-details">Distance: Bogotá → Miami (2,500 km)</div>
                        <div class="seal-badge">
                            <i class="fas fa-check"></i> Verified
                        </div>
                    </div>

                    <div class="seal-card deforestation">
                        <div class="seal-header">
                            <h3>Deforestation-Free Seal</h3>
                            <div class="seal-icon deforestation">
                                <i class="fas fa-tree"></i>
                            </div>
                        </div>
                        <div class="seal-value deforestation">EU Compliant</div>
                        <div class="seal-label">EUDR Regulation</div>
                        <div class="seal-details">Cert: EU-EUDR-CERT-2025-001</div>
                        <div class="seal-badge deforestation">
                            <i class="fas fa-check"></i> Verified
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Farmer Portal Tab -->
        <div id="farmer-tab" class="tab-content hidden">
            <div class="form-grid">
                <!-- Register Farm -->
                <div class="form-card">
                    <h3 class="form-title">
                        <i class="fas fa-plus-circle" style="color: #10b981; margin-right: 8px;"></i>
                        Register New Farm
                    </h3>
                    <form id="farmForm">
                        <div class="form-group">
                            <label class="form-label">Farm Name</label>
                            <input type="text" id="farmName" class="form-input" placeholder="e.g., Finca Verde">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Latitude</label>
                                <input type="number" step="any" id="farmLat" class="form-input" placeholder="4.596">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Longitude</label>
                                <input type="number" step="any" id="farmLon" class="form-input" placeholder="-74.081">
                            </div>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="deforestationFree">
                            <label>Deforestation-Free Certified</label>
                        </div>
                        <button type="submit" class="form-btn primary">
                            <i class="fas fa-tractor"></i> Register Farm
                        </button>
                    </form>
                </div>

                <!-- Register Product -->
                <div class="form-card">
                    <h3 class="form-title">
                        <i class="fas fa-seedling" style="color: #3b82f6; margin-right: 8px;"></i>
                        Register New Product
                    </h3>
                    <form id="productForm">
                        <div class="form-group">
                            <label class="form-label">Farm ID</label>
                            <input type="number" id="productFarmId" class="form-input" placeholder="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Product Name</label>
                            <input type="text" id="productName" class="form-input" placeholder="e.g., Café Arábica">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Quantity (kg)</label>
                                <input type="number" id="productQuantity" class="form-input" placeholder="1000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Batch ID</label>
                                <input type="text" id="productBatch" class="form-input" placeholder="LOTE001-2025">
                            </div>
                        </div>
                        <button type="submit" class="form-btn secondary">
                            <i class="fas fa-plus"></i> Register Product
                        </button>
                    </form>
                </div>
            </div>

            <!-- Issue Seals -->
            <div class="card mt-4">
                <h3 class="form-title text-center">
                    <i class="fas fa-certificate" style="color: #7c3aed; margin-right: 8px;"></i>
                    Issue Environmental Seals
                </h3>
                <div class="form-grid">
                    <div class="form-card">
                        <h4 style="font-weight: 600; margin-bottom: 15px;">Carbon Footprint Seal</h4>
                        <form id="carbonForm">
                            <div class="form-group">
                                <input type="number" id="carbonProductId" class="form-input" placeholder="Product ID">
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <input type="number" step="any" id="consumerLat" class="form-input" placeholder="Consumer Lat">
                                </div>
                                <div class="form-group">
                                    <input type="number" step="any" id="consumerLon" class="form-input" placeholder="Consumer Lon">
                                </div>
                            </div>
                            <button type="submit" class="form-btn primary">
                                Issue Carbon Seal
                            </button>
                        </form>
                    </div>
                    <div class="form-card">
                        <h4 style="font-weight: 600; margin-bottom: 15px;">Deforestation-Free Seal</h4>
                        <form id="deforestationForm">
                            <div class="form-group">
                                <input type="number" id="defoProductId" class="form-input" placeholder="Product ID">
                            </div>
                            <div class="form-group">
                                <input type="text" id="verificationData" class="form-input" placeholder="Verification Data">
                            </div>
                            <button type="submit" class="form-btn secondary">
                                Issue Deforestation Seal
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Consumer Portal Tab -->
        <div id="consumer-tab" class="tab-content hidden">
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-qrcode" style="color: #7c3aed; margin-right: 12px;"></i>
                    Verify Product Authenticity
                </h2>
                
                <div class="verify-container">
                    <div class="form-group">
                        <label class="form-label">Enter Product ID or Scan QR</label>
                        <div class="verify-input">
                            <input type="number" id="verifyProductId" class="form-input" placeholder="Product ID" style="flex: 1;">
                            <button id="verifyBtn" class="form-btn primary" style="width: auto; padding: 12px 20px;">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="verificationResult" class="verify-result hidden">
                        <div class="verify-header">
                            <i class="fas fa-check-circle"></i>
                            <span class="verify-title">Product Verified</span>
                        </div>
                        <div id="verificationDetails" class="verify-details">
                            <!-- Product details will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Toast -->
    <div id="toast" class="toast">
        <i class="fas fa-check"></i>
        <span id="toastMessage">Action completed successfully!</span>
    </div>

    <script>
        // Contract configuration - REPLACE WITH YOUR DEPLOYED CONTRACT
        const CONTRACT_ADDRESS = "0x361EB39782f27fCBFc1fD63d2cb4E42baE777Bee";
        const CONTRACT_ABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "ERC721IncorrectOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "ERC721InsufficientApproval",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "approver",
				"type": "address"
			}
		],
		"name": "ERC721InvalidApprover",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			}
		],
		"name": "ERC721InvalidOperator",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "ERC721InvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			}
		],
		"name": "ERC721InvalidReceiver",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			}
		],
		"name": "ERC721InvalidSender",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "ERC721NonexistentToken",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "approved",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "ApprovalForAll",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "_fromTokenId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "_toTokenId",
				"type": "uint256"
			}
		],
		"name": "BatchMetadataUpdate",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "farmId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "farmer",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			}
		],
		"name": "FarmRegistered",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			},
			{
				"internalType": "int256",
				"name": "_consumerLat",
				"type": "int256"
			},
			{
				"internalType": "int256",
				"name": "_consumerLon",
				"type": "int256"
			},
			{
				"internalType": "string",
				"name": "_tokenURI",
				"type": "string"
			}
		],
		"name": "issueCarbonFootprintSeal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_verificationData",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_tokenURI",
				"type": "string"
			}
		],
		"name": "issueDeforestationFreeSeal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "MetadataUpdate",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "farmId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "productName",
				"type": "string"
			}
		],
		"name": "ProductRegistered",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "int256",
				"name": "_latitude",
				"type": "int256"
			},
			{
				"internalType": "int256",
				"name": "_longitude",
				"type": "int256"
			},
			{
				"internalType": "bool",
				"name": "_isDeforestationFree",
				"type": "bool"
			}
		],
		"name": "registerFarm",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_farmId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_productName",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_quantity",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_batchId",
				"type": "string"
			}
		],
		"name": "registerProduct",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "enum EcoTraceDAO.SealType",
				"name": "sealType",
				"type": "uint8"
			}
		],
		"name": "SealIssued",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "setApprovalForAll",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "int256",
				"name": "_farmLat",
				"type": "int256"
			},
			{
				"internalType": "int256",
				"name": "_farmLon",
				"type": "int256"
			},
			{
				"internalType": "int256",
				"name": "_consumerLat",
				"type": "int256"
			},
			{
				"internalType": "int256",
				"name": "_consumerLon",
				"type": "int256"
			}
		],
		"name": "calculateCarbonFootprint",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "farmCounter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "farmerFarms",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "farmProducts",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "farms",
		"outputs": [
			{
				"internalType": "address",
				"name": "farmer",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "int256",
				"name": "latitude",
				"type": "int256"
			},
			{
				"internalType": "int256",
				"name": "longitude",
				"type": "int256"
			},
			{
				"internalType": "bool",
				"name": "isDeforestationFree",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "registrationDate",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "isActive",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "getApproved",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_farmId",
				"type": "uint256"
			}
		],
		"name": "getFarm",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "farmer",
						"type": "address"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "int256",
						"name": "latitude",
						"type": "int256"
					},
					{
						"internalType": "int256",
						"name": "longitude",
						"type": "int256"
					},
					{
						"internalType": "bool",
						"name": "isDeforestationFree",
						"type": "bool"
					},
					{
						"internalType": "uint256",
						"name": "registrationDate",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "isActive",
						"type": "bool"
					}
				],
				"internalType": "struct EcoTraceDAO.Farm",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_farmer",
				"type": "address"
			}
		],
		"name": "getFarmerFarms",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_farmId",
				"type": "uint256"
			}
		],
		"name": "getFarmProducts",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			}
		],
		"name": "getProduct",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "farmId",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "productName",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "productionDate",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "quantity",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "batchId",
						"type": "string"
					}
				],
				"internalType": "struct EcoTraceDAO.Product",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"name": "getSeal",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "productId",
						"type": "uint256"
					},
					{
						"internalType": "enum EcoTraceDAO.SealType",
						"name": "sealType",
						"type": "uint8"
					},
					{
						"internalType": "uint256",
						"name": "carbonFootprint",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "isValid",
						"type": "bool"
					},
					{
						"internalType": "uint256",
						"name": "issuanceDate",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "verificationData",
						"type": "string"
					}
				],
				"internalType": "struct EcoTraceDAO.EnvironmentalSeal",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			}
		],
		"name": "isApprovedForAll",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "ownerOf",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "productCounter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "products",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "farmId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "productName",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "productionDate",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "quantity",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "batchId",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "seals",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"internalType": "enum EcoTraceDAO.SealType",
				"name": "sealType",
				"type": "uint8"
			},
			{
				"internalType": "uint256",
				"name": "carbonFootprint",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "isValid",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "issuanceDate",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "verificationData",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "interfaceId",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "tokenURI",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

        let web3;
        let contract;
        let currentAccount;

        // Initialize Web3
        async function initWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    currentAccount = accounts[0];
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    document.getElementById('connectBtn').innerHTML = '<i class="fas fa-check"></i> Connected';
                    document.getElementById('connectBtn').classList.add('connected');
                    showToast('Wallet connected successfully!');
                } catch (error) {
                    showToast('Failed to connect wallet', 'error');
                }
            } else {
                showToast('Please install MetaMask!', 'error');
            }
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Add active class to clicked tab
                btn.classList.add('active');
                
                // Show corresponding content
                const tabId = btn.getAttribute('data-tab') + '-tab';
                document.getElementById(tabId).classList.remove('hidden');
            });
        });

        // Form handlers
        document.getElementById('farmForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!contract) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const name = document.getElementById('farmName').value;
            const lat = Math.floor(parseFloat(document.getElementById('farmLat').value) * 1000000);
            const lon = Math.floor(parseFloat(document.getElementById('farmLon').value) * 1000000);
            const defoFree = document.getElementById('deforestationFree').checked;

            try {
                await contract.methods.registerFarm(name, lat, lon, defoFree).send({ from: currentAccount });
                showToast('Farm registered successfully!');
                document.getElementById('farmForm').reset();
            } catch (error) {
                showToast('Failed to register farm', 'error');
            }
        });

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!contract) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const farmId = document.getElementById('productFarmId').value;
            const name = document.getElementById('productName').value;
            const quantity = document.getElementById('productQuantity').value;
            const batch = document.getElementById('productBatch').value;

            try {
                await contract.methods.registerProduct(farmId, name, quantity, batch).send({ from: currentAccount });
                showToast('Product registered successfully!');
                document.getElementById('productForm').reset();
            } catch (error) {
                showToast('Failed to register product', 'error');
            }
        });

        document.getElementById('carbonForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!contract) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const productId = document.getElementById('carbonProductId').value;
            const consumerLat = Math.floor(parseFloat(document.getElementById('consumerLat').value) * 1000000);
            const consumerLon = Math.floor(parseFloat(document.getElementById('consumerLon').value) * 1000000);
            const tokenURI = "https://ipfs.io/ipfs/QmExample";

            try {
                await contract.methods.issueCarbonFootprintSeal(productId, consumerLat, consumerLon, tokenURI).send({ from: currentAccount });
                showToast('Carbon footprint seal issued!');
                document.getElementById('carbonForm').reset();
            } catch (error) {
                showToast('Failed to issue carbon seal', 'error');
            }
        });

        document.getElementById('deforestationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!contract) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const productId = document.getElementById('defoProductId').value;
            const verificationData = document.getElementById('verificationData').value;
            const tokenURI = "https://ipfs.io/ipfs/QmExample2";

            try {
                await contract.methods.issueDeforestationFreeSeal(productId, verificationData, tokenURI).send({ from: currentAccount });
                showToast('Deforestation-free seal issued!');
                document.getElementById('deforestationForm').reset();
            } catch (error) {
                showToast('Failed to issue deforestation seal', 'error');
            }
        });

        // Connect wallet button
        document.getElementById('connectBtn').addEventListener('click', initWeb3);

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Verify product
        document.getElementById('verifyBtn').addEventListener('click', async () => {
            const productId = document.getElementById('verifyProductId').value;
            if (!productId || !contract) {
                showToast('Please enter a product ID and connect wallet', 'error');
                return;
            }

            try {
                const product = await contract.methods.getProduct(productId).call();
                const farm = await contract.methods.getFarm(product.farmId).call();
                
                document.getElementById('verificationDetails').innerHTML = `
                    <p><strong>Product:</strong> ${product.productName}</p>
                    <p><strong>Farm:</strong> ${farm.name}</p>
                    <p><strong>Farmer:</strong> ${farm.farmer}</p>
                    <p><strong>Batch:</strong> ${product.batchId}</p>
                    <p><strong>Quantity:</strong> ${product.quantity} kg</p>
                    <p><strong>Deforestation-Free:</strong> ${farm.isDeforestationFree ? 'Yes' : 'No'}</p>
                `;
                
                document.getElementById('verificationResult').classList.remove('hidden');
                showToast('Product verified successfully!');
            } catch (error) {
                showToast('Product not found or error occurred', 'error');
                document.getElementById('verificationResult').classList.add('hidden');
            }
        });
    </script>
</body>
</html>